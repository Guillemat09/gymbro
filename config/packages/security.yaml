# config/packages/security.yaml
security:
  # Usa 'auto' en lugar de 'plaintext' (plaintext solo para pruebas)
  password_hashers:
    App\Entity\Usuario: 'plaintext'
    # Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'

  # Jerarquía de roles:
  # - ADMIN hereda de PROFESOR y ALUMNO (y de USER)
  # - PROFESOR y ALUMNO heredan de USER
  role_hierarchy:
    ROLE_ADMIN:    [ROLE_PROFESOR, ROLE_ALUMNO, ROLE_USER]
    ROLE_PROFESOR: [ROLE_USER]
    ROLE_ALUMNO:   [ROLE_USER]

  providers:
    app_user_provider:
      entity:
        class: App\Entity\Usuario
        property: email

  firewalls:
    dev:
      pattern: ^/(?:_(profiler|wdt)|css|images|js|build)/
      security: false

    main:
      lazy: true
      provider: app_user_provider

      form_login:
        login_path: app_login
        check_path: app_login
        enable_csrf: true
        # Puedes dejar este target o cambiarlo a una ruta común para todos (p. ej. reservas)
        default_target_path: app_reserva

      logout:
        path: app_logout
        target: app_login

  # Orden: primero lo más específico
  access_control:
    # Público
    - { path: ^/login, roles: PUBLIC_ACCESS }
    - { path: ^/(?:css|js|images|build)/, roles: PUBLIC_ACCESS }

    # Gestión de usuarios: solo ADMIN
    - { path: ^/usuario, roles: ROLE_ADMIN }

    # Clases: ADMIN y PROFESOR
    - { path: ^/clase, roles: [ROLE_ADMIN, ROLE_PROFESOR] }

    # Reservas: ADMIN, PROFESOR y ALUMNO
    - { path: ^/reserva, roles: [ROLE_ADMIN, ROLE_PROFESOR, ROLE_ALUMNO] }

    # Rutinas: ADMIN, PROFESOR y ALUMNO
    - { path: ^/rutina, roles: [ROLE_ADMIN, ROLE_PROFESOR, ROLE_ALUMNO] }

    # Fallback: cualquier otra ruta requiere al menos usuario autenticado
    - { path: ^/, roles: ROLE_USER }
