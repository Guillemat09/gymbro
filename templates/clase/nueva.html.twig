{# filepath: d:\tfg\gymbro\templates\clase\nueva.html.twig #}
{% extends 'base.html.twig' %}
{% form_theme form 'form/custom_errors.html.twig' %}

{% block title %}{{ titulo }}{% endblock %}

{% block back_button %}
<a href="javascript:history.back()" class="btn btn-outline-primary mb-3">
    <i class="bi bi-arrow-left"></i> Volver atr√°s
</a>
{% endblock %}

{% block body %}
    <h1 class="display-5 mb-4">{{ titulo }}</h1>
    <div class="card p-4">
        {{ form_start(form) }}
            {{ form_row(form.nombre) }}
            {{ form_row(form.fecha) }}
            {{ form_row(form.hora) }}
            {{ form_row(form.duracion) }}
            {{ form_row(form.lugar) }}
            {{ form_row(form.limite) }}

            {# ====== PROFESOR (condicionado por rol) ====== #}
            {% if is_granted('ROLE_ADMIN') %}
                {# Admin: selector completo #}
                {{ form_row(form.profesor) }}
            {% elseif is_granted('ROLE_PROFESOR') and app.user.profesor is defined and app.user.profesor %}
                {# Profesor: NO mostrar selector; fijar su propio id #}
                {% do form.profesor.setRendered %}
                <div class="mb-3">
                    <label class="form-label">Profesor</label>
                    <div class="form-control-plaintext">
                        {{ app.user.nombre ~ (app.user.apellido1 ? ' ' ~ app.user.apellido1 : '') }}
                    </div>
                </div>
                <input type="hidden" name="{{ form.profesor.vars.full_name }}" value="{{ app.user.profesor.id }}">
            {% else %}
                {# Otros roles (si los hubiera): mostrar selector por defecto #}
                {{ form_row(form.profesor) }}
            {% endif %}
            {# ====== FIN PROFESOR ====== #}

            {{ form_row(form.guardar) }}

            {# Importante: al desactivar render_rest, pintamos manualmente el token #}
            {% if form._token is defined %}
                {{ form_row(form._token) }}
            {% endif %}
        {{ form_end(form, { render_rest: false }) }}
    </div>
{% endblock %}
