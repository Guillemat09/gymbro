{% extends 'base.html.twig' %}

{% block title %}{{ titulo }}{% endblock %}

{% block back_button %}
<a href="javascript:history.back()" class="btn btn-outline-primary mb-3">
    <i class="bi bi-arrow-left"></i> Volver atrás
</a>
{% endblock %}

{% block body %}
<h1 class="h3 mb-4">{{ titulo }}</h1>

{# Mensajes flash #}
{% for label, messages in app.flashes %}
  {% for message in messages %}
    <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
    </div>
  {% endfor %}
{% endfor %}

<div class="card shadow-sm p-4">
  {{ form_start(form) }}

    {# Solo ADMIN y PROFESOR pueden seleccionar alumno #}
    {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_PROFESOR') %}
      <div class="mb-3">
        {{ form_label(form.alumno) }}
        {{ form_widget(form.alumno, { 'attr': {'class': 'form-select'} }) }}
        {{ form_errors(form.alumno) }}
      </div>
    {% endif %}

    <div class="mb-3">
      {{ form_label(form.clase) }}
      {{ form_widget(form.clase, { 'attr': {'class': 'form-select', 'id':'clase-select'} }) }}
      {{ form_errors(form.clase) }}
    </div>

    {# Información dinámica de la clase #}
    <div id="info-clase" class="alert alert-info mt-3" style="display:none;">
      <p><strong>Profesor:</strong> <span id="profesor-info"></span></p>
      <p><strong>Fecha de la clase:</strong> <span id="fecha-info"></span></p>
    </div>

    <div class="mt-4">
      <button class="btn btn-primary">
        <i class="bi bi-check-lg me-1"></i> Guardar reserva
      </button>
      <a href="{{ path('app_reserva') }}" class="btn btn-outline-secondary ms-2">
        Cancelar
      </a>
    </div>

  {{ form_end(form) }}
</div>

{# Script para mostrar la información de la clase seleccionada usando data-* añadidos por el form #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const claseSelect = document.getElementById('clase-select');
    const infoBox = document.getElementById('info-clase');
    const profesorInfo = document.getElementById('profesor-info');
    const fechaInfo = document.getElementById('fecha-info');

    function mostrarInfoClase() {
        const selected = claseSelect.options[claseSelect.selectedIndex];
        if (!selected || !selected.dataset.profesor) {
            infoBox.style.display = 'none';
            return;
        }

        profesorInfo.textContent = selected.dataset.profesor;
        fechaInfo.textContent = selected.dataset.fecha;
        infoBox.style.display = 'block';
    }

    claseSelect.addEventListener('change', mostrarInfoClase);
    mostrarInfoClase();
});
</script>

{% endblock %}
