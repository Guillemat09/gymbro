{% extends 'base.html.twig' %}

{% block title %}{{ titulo }}{% endblock %}

{# --- BOTÓN VOLVER ATRÁS (usando el bloque del layout) --- #}
{% block back_button %}
<a href="javascript:history.back()" class="btn btn-outline-primary mb-3">
    <i class="bi bi-arrow-left"></i> Volver atrás
</a>
{% endblock %}

{% block body %}
    <h1 class="display-5 mb-4">{{ titulo }}</h1>

    <div class="card p-4">
        {{ form_start(form) }}
            {{ form_row(form.email) }}
            {{ form_row(form.nombre) }}
            {% if errores.nombre is defined %}
                <div class="text-danger small">{{ errores.nombre }}</div>
            {% endif %}
            {{ form_row(form.apellido1) }}
            {% if errores.apellido1 is defined %}
                <div class="text-danger small">{{ errores.apellido1 }}</div>
            {% endif %}
            {{ form_row(form.apellido2) }}
            {% if errores.apellido2 is defined %}
                <div class="text-danger small">{{ errores.apellido2 }}</div>
            {% endif %}
            {{ form_row(form.password) }}
            {% if errores.password is defined %}
                <div class="text-danger small">{{ errores.password }}</div>
            {% endif %}

            {% if usuario.tipo == 'alumno' and usuario.alumno %}
                <hr>
                <h5>Datos de Alumno</h5>
                {# Campo de fecha de nacimiento #}
                <div class="mb-3">
                    <label for="fechaNacimiento" class="form-label">Fecha de nacimiento</label>
                    <input type="date" id="fechaNacimiento" name="fechaNacimiento" class="form-control"
                        value="{{ app.request.request.get('fechaNacimiento') ?? usuario.alumno.fechaNacimiento|date('Y-m-d') }}">
                    {% if errores.fechaNacimiento is defined %}
                        <div class="text-danger small">{{ errores.fechaNacimiento }}</div>
                    {% endif %}
                </div>

                {# Campo de peso #}
                <div class="mb-3">
                    <label for="peso" class="form-label">Peso (kg)</label>
                    <input type="number" id="peso" name="peso" class="form-control"
                        value="{{ app.request.request.get('peso') ?? usuario.alumno.peso }}">
                    {% if errores.peso is defined %}
                        <div class="text-danger small">{{ errores.peso }}</div>
                    {% endif %}
                </div>

                {# Campo de altura #}
                <div class="mb-3">
                    <label for="altura" class="form-label">Altura (cm)</label>
                    <input type="number" id="altura" name="altura" class="form-control"
                        value="{{ app.request.request.get('altura') ?? usuario.alumno.altura }}">
                    {% if errores.altura is defined %}
                        <div class="text-danger small">{{ errores.altura }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="sexo" class="form-label">Sexo</label>
                    <select id="sexo" name="sexo" class="form-select">
                        <option value="masculino" {% if usuario.alumno.sexo == 'masculino' %}selected{% endif %}>Masculino</option>
                        <option value="femenino" {% if usuario.alumno.sexo == 'femenino' %}selected{% endif %}>Femenino</option>
                        <option value="otro" {% if usuario.alumno.sexo == 'otro' %}selected{% endif %}>Otro</option>
                    </select>
                </div>

            {% elseif usuario.tipo == 'profesor' and usuario.profesor %}
                <hr>
                <h5>Datos de Profesor</h5>
                <div class="mb-3">
                    <label for="especialidad" class="form-label">Especialidad</label>
                    <input type="text" id="especialidad" name="especialidad" class="form-control"
                        value="{{ usuario.profesor.especialidad }}">
                </div>

            {% elseif usuario.tipo == 'administrador' and usuario.administrador %}
                <hr>
                <h5>Datos de Administrador</h5>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="activo" name="activo"
                        {% if usuario.administrador.activo %}checked{% endif %}>
                    <label class="form-check-label" for="activo">Administrador activo</label>
                </div>
            {% endif %}

            {% if errores.alumno is defined %}
                <div class="text-danger small">{{ errores.alumno }}</div>
            {% endif %}
            {% if errores.profesor is defined %}
                <div class="text-danger small">{{ errores.profesor }}</div>
            {% endif %}
            {% if errores.tipo is defined %}
                <div class="text-danger small">{{ errores.tipo }}</div>
            {% endif %}

            {{ form_row(form.guardar) }}
        {{ form_end(form) }}
    </div>
{% endblock %}
